<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compteur de Calorie en Ligne</title>
      <link rel="shortcut icon" href="logo.png">
    <style>
        body {
            background: url('https://img.freepik.com/photos-premium/salle-sport-sombre-lumiere-rouge-bas-ecran_911201-3384.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #FF1F09;
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background: #1a1a1a;
            padding: 20px;
            text-align: center;
            font-size: 2em;
            color: #FF1F09;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .section {
            background: #333;
            padding: 20px;
            margin: 20px 0;
            display: none;
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        .section.active {
            display: block;
        }
        label, input, select {
            display: block;
            margin: 10px 0;
            width: 100%;
        }
        input, select {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: #444;
            color: #FF1F09;
        }
        button {
            background: #FF1F09;
            border: none;
            padding: 10px 20px;
            color: black;
            cursor: pointer;
            border-radius: 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #FF1F09;
        }
        footer {
            background: #1a1a1a;
            text-align: center;
            padding: 10px;
            color: #FF1F09;
            box-shadow: 0 -4px 8px rgba(0, 0, 0, 0.3);
        }
        canvas {
            width: 100% !important;
            max-width: 600px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #444;
            padding: 10px;
            text-align: center;
        }
        th {
            background: #444;
        }
        td button {
            background: #FF1F09;
            color: black;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        Compteur de Calorie en Ligne
    </header>
    <div class="container">
        <div id="menu" class="section active">
            <h2>Menu Principal</h2>
            <button onclick="showSection('calcul')">Calculer les calories</button>
            <button onclick="showSection('graphique')">Voir l'évolution</button>
        </div>
        <div id="calcul" class="section">
            <h2>Calcul des Calories</h2>
            <label for="regime">Choisissez votre régime :</label>
            <select id="regime">
                <option value="1">Prise de masse</option>
                <option value="2">Sèche</option>
                <option value="3">Maintenance</option>
            </select>
            <div id="surplusDeficit">
                <label id="labelSurplusDeficit" for="calories">De combien de calories voulez-vous être en <span id="surplusDeficitText">surplus</span> ?</label>
                <input type="number" id="calories">
            </div>
            <label for="caloriesBrulees">Combien de calories votre Apple Watch indique-t-elle que vous avez brûlées aujourd'hui ?</label>
            <input type="number" id="caloriesBrulees">
            <label>Avez-vous fait de la musculation aujourd'hui ?</label>
            <input type="radio" id="muscuOui" name="musculation" value="oui">
            <label for="muscuOui">Oui</label>
            <input type="radio" id="muscuNon" name="musculation" value="non" checked>
            <label for="muscuNon">Non</label>
            <div id="detailsMuscu" style="display: none;">
                <label for="caloriesMuscu">Combien de calories avez-vous brûlées pendant la séance de musculation ?</label>
                <input type="number" id="caloriesMuscu">
                <label for="dureeMuscu">Quelle était la durée de la séance de musculation en minutes ?</label>
                <input type="number" id="dureeMuscu">
                <label for="poids">Quel est votre poids (kg) ?</label>
                <input type="number" id="poids">
            </div>
            <button onclick="calculerCalories()">Calculer</button>
            <p id="resultat"></p>
        </div>
        <div id="graphique" class="section">
            <h2>Évolution des Données</h2>
            <canvas id="graphiqueCalories"></canvas>
            <canvas id="graphiquePoids"></canvas>
            <canvas id="graphiqueDuree"></canvas>
            <canvas id="graphiqueSurplusDeficit"></canvas>
            <table id="tableHistorique">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Calories Totales</th>
                        <th>Calories Brûlées</th>
                        <th>Calories Muscu</th>
                        <th>Durée Muscu</th>
                        <th>Poids</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
            <button onclick="showSection('menu')">Retour au menu</button>
        </div>
    </div>
    <footer>
        &copy; 2024 Compteur de Calorie en Ligne
    </footer>
    <script>
        document.getElementById('regime').addEventListener('change', function() {
            const regime = document.getElementById('regime').value;
            const surplusDeficitText = document.getElementById('surplusDeficitText');
            const surplusDeficit = document.getElementById('surplusDeficit');
            if (regime == '1') {
                surplusDeficitText.innerText = 'surplus';
                surplusDeficit.style.display = 'block';
            } else if (regime == '2') {
                surplusDeficitText.innerText = 'déficit';
                surplusDeficit.style.display = 'block';
            } else {
                surplusDeficit.style.display = 'none';
            }
        });

        document.getElementsByName('musculation').forEach(radio => {
            radio.addEventListener('change', function() {
                const detailsMuscu = document.getElementById('detailsMuscu');
                if (document.getElementById('muscuOui').checked) {
                    detailsMuscu.style.display = 'block';
                } else {
                    detailsMuscu.style.display = 'none';
                }
            });
        });

        function showSection(id) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(id).classList.add('active');
            if (id === 'graphique') {
                afficherGraphiques();
                afficherTableau();
            }
        }

        function calculerCalories() {
            const regime = document.getElementById('regime').value;
            const calories = parseInt(document.getElementById('calories').value) || 0;
            let caloriesBrulees = parseInt(document.getElementById('caloriesBrulees').value) || 0;
            const faitMuscu = document.getElementById('muscuOui').checked;
            let caloriesMuscu = 0;
            let dureeMuscu = 0;
            let poids = 0;

            if (faitMuscu) {
                const caloriesMuscuSaisie = parseInt(document.getElementById('caloriesMuscu').value) || 0;
                dureeMuscu = parseInt(document.getElementById('dureeMuscu').value) || 0;
                poids = parseFloat(document.getElementById('poids').value) || 0;

                // Calcul des nouvelles calories brûlées pendant la musculation
                caloriesMuscu = 3.5 * 3.5 * (poids / 200) * dureeMuscu;

                // Ajuster les calories brûlées par la séance de musculation
                caloriesBrulees = caloriesBrulees - caloriesMuscuSaisie + caloriesMuscu;
            }

            let totalCalories = 2000; // Calories de maintenance
            if (regime == '1') {
                totalCalories += calories; // Prise de masse (surplus)
            } else if (regime == '2') {
                totalCalories -= calories; // Sèche (déficit)
            }
            totalCalories += caloriesBrulees;

            document.getElementById('resultat').innerText = 'Votre total de calories pour aujourd\'hui est : ' + totalCalories + ' calories.';

            // Sauvegarder les données dans localStorage
            sauvegarderDonnees(totalCalories, caloriesBrulees, caloriesMuscu, dureeMuscu, poids);
        }

        function sauvegarderDonnees(totalCalories, caloriesBrulees, caloriesMuscu, dureeMuscu, poids) {
            const date = new Date().toISOString().split('T')[0]; // Format YYYY-MM-DD
            const donnees = {
                date: date,
                totalCalories: totalCalories,
                caloriesBrulees: caloriesBrulees,
                caloriesMuscu: caloriesMuscu,
                dureeMuscu: dureeMuscu,
                poids: poids
            };

            let historique = JSON.parse(localStorage.getItem('historiqueCalories')) || [];
            historique.push(donnees);
            localStorage.setItem('historiqueCalories', JSON.stringify(historique));
        }

        function afficherGraphiques() {
            const historique = JSON.parse(localStorage.getItem('historiqueCalories')) || [];
            const labels = historique.map(d => d.date);
            const dataCalories = historique.map(d => d.totalCalories);
            const dataPoids = historique.map(d => d.poids);
            const dataDuree = historique.map(d => d.dureeMuscu);
            const dataSurplusDeficit = historique.map(d => {
                const regime = d.totalCalories - d.caloriesBrulees;
                return regime > 2000 ? regime - 2000 : 2000 - regime;
            });

            const ctxCalories = document.getElementById('graphiqueCalories').getContext('2d');
            const ctxPoids = document.getElementById('graphiquePoids').getContext('2d');
            const ctxDuree = document.getElementById('graphiqueDuree').getContext('2d');
            const ctxSurplusDeficit = document.getElementById('graphiqueSurplusDeficit').getContext('2d');

            new Chart(ctxCalories, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total Calories',
                        data: dataCalories,
                        borderColor: '#00bcd4',
                        backgroundColor: 'rgba(0, 188, 212, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Calories'
                            }
                        }
                    }
                }
            });

            new Chart(ctxPoids, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Poids (kg)',
                        data: dataPoids,
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Poids (kg)'
                            }
                        }
                    }
                }
            });

            new Chart(ctxDuree, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Durée Musculation (min)',
                        data: dataDuree,
                        borderColor: '#8bc34a',
                        backgroundColor: 'rgba(139, 195, 74, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Durée Musculation (min)'
                            }
                        }
                    }
                }
            });

            new Chart(ctxSurplusDeficit, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Surplus/Déficit Calories',
                        data: dataSurplusDeficit,
                        borderColor: '#e91e63',
                        backgroundColor: 'rgba(233, 30, 99, 0.2)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Surplus/Déficit Calories'
                            }
                        }
                    }
                }
            });
        }

        function afficherTableau() {
            const historique = JSON.parse(localStorage.getItem('historiqueCalories')) || [];
            const tbody = document.getElementById('tableHistorique').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            historique.forEach((donnee, index) => {
                const tr = document.createElement('tr');

                Object.keys(donnee).forEach(key => {
                    const td = document.createElement('td');
                    td.innerText = donnee[key];
                    tr.appendChild(td);
                });

                const tdActions = document.createElement('td');
                const btnModifier = document.createElement('button');
                btnModifier.innerText = 'Modifier';
                btnModifier.onclick = () => modifierDonnee(index);
                const btnSupprimer = document.createElement('button');
                btnSupprimer.innerText = 'Supprimer';
                btnSupprimer.onclick = () => supprimerDonnee(index);
                tdActions.appendChild(btnModifier);
                tdActions.appendChild(btnSupprimer);
                tr.appendChild(tdActions);

                tbody.appendChild(tr);
            });
        }

        function modifierDonnee(index) {
            const historique = JSON.parse(localStorage.getItem('historiqueCalories')) || [];
            const donnee = historique[index];

            document.getElementById('regime').value = '3'; // Default to Maintenance
            document.getElementById('calories').value = donnee.calories || 0;
            document.getElementById('caloriesBrulees').value = donnee.caloriesBrulees || 0;
            if (donnee.caloriesMuscu > 0) {
                document.getElementById('muscuOui').checked = true;
                document.getElementById('detailsMuscu').style.display = 'block';
                document.getElementById('caloriesMuscu').value = donnee.caloriesMuscu || 0;
                document.getElementById('dureeMuscu').value = donnee.dureeMuscu || 0;
                document.getElementById('poids').value = donnee.poids || 0;
            } else {
                document.getElementById('muscuNon').checked = true;
                document.getElementById('detailsMuscu').style.display = 'none';
            }

            // Remove the old entry before adding the updated one
            historique.splice(index, 1);
            localStorage.setItem('historiqueCalories', JSON.stringify(historique));

            showSection('calcul');
        }

        function supprimerDonnee(index) {
            let historique = JSON.parse(localStorage.getItem('historiqueCalories')) || [];
            historique.splice(index, 1);
            localStorage.setItem('historiqueCalories', JSON.stringify(historique));
            afficherTableau();
            afficherGraphiques();
        }
    </script>
</body>
</html>
